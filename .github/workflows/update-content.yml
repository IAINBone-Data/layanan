name: Update App Content & Deploy

on:
  schedule:
    - cron: '0 0 * * *' # Jalan setiap hari jam 00:00 UTC (08:00 WITA)
  workflow_dispatch: # Tombol manual "Run Workflow"

# Memberikan izin kepada bot untuk menulis ke repository
permissions:
  contents: write

jobs:
  update-and-deploy:
    runs-on: ubuntu-latest

    steps:
    # 1. Checkout kode sumber (Branch main)
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. Siapkan Node.js
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    # 3. Install Dependensi (untuk script generator & build vite)
    - name: Install Dependencies
      run: npm install

    # 4. Jalankan Script Generator Data (Ambil dari Google Sheets)
    - name: Generate Content JSON
      run: node scripts/generate-content.cjs

    # 5. Commit & Push Data JSON Terbaru ke Branch 'main'
    # Ini memastikan repo source code kita juga punya data terbaru
    - name: Commit and Push Data Changes
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: "ðŸ¤– Auto-update data from Google Sheets [Skip CI]"
        file_pattern: public/data/*.json
        branch: main

    # 6. Build Aplikasi (Membuat folder dist dengan data baru)
    - name: Build Project
      run: npm run build

    # 7. Deploy Folder 'dist' ke Branch 'gh-pages'
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
        publish_branch: gh-pages
        commit_message: "ðŸš€ Auto-deploy updated content"
